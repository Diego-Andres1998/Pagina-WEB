<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Estudiantil Minimalista - Horario de Clases</title> <!-- Título actualizado -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Incluye Tailwind CSS para el estilo rápido y responsivo del calendario -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ====================================================================
           SECCIÓN: ESTILOS GENERALES Y RESETEO
           Descripción: Define variables CSS para colores y espaciados, y resetea
                        los estilos por defecto de los navegadores.
           ====================================================================
        */
        :root {
            --color-primario: #0056b3; /* Un azul institucional (Original) */
            --color-secundario: #f0f2f5; /* Gris claro para fondos (Original) */
            --color-texto: #333; /* Original */
            --color-texto-claro: #666; /* Original */
            --color-exito: #28a745; /* Original */
            --color-advertencia: #ffc107; /* Original */
            --color-error: #dc3545; /* Original */
            --espaciado-md: 20px; /* Original */
            --espaciado-lg: 40px; /* Original */
            --borde-radio: 8px; /* Original */
            --sombra-suave: 0 4px 6px rgba(0, 0, 0, 0.1); /* Original */

            --color-modulo-azul: #007bff; /* Original */
            --color-modulo-naranja: #fd7e14; /* Original */
            --color-modulo-verde: #28a745; /* Original */

            /* Nuevas variables del login para sobrescribir o complementar */
            --primary-login-color: #2E8B57; /* Verde (nuevo login) */
            --secondary-login-color: #1565C0; /* Azul (nuevo login) */
            --accent-login-color: #FF8C00; /* Naranja (nuevo login) */
            --text-login-color: #4B5563; /* Gris oscuro (nuevo login) */
            --heading-login-color: #111827; /* Casi negro (nuevo login) */
            --error-login-color: #EF4444; /* Rojo (nuevo login) */
            --success-login-color: #10B981; /* Verde (nuevo login) */
            --background-login-color: #F9FAFB; /* Gris claro (nuevo login) */
            --card-background-login: #ffffff; /* Blanco (nuevo login) */
            --input-border-login: #E5E7EB; /* Gris muy claro (nuevo login) */
            --input-focus-login: #2E8B57; /* Verde para el foco (nuevo login) */
            --animation-duration: 0.3s; /* Nuevo login */

            /* Variables de color de notas.txt mapeadas a variables existentes o nuevas */
            --cft-verde-notas: #006837; /* Mantener si es un verde específico para notas */
            --cft-azul-notas: #0056a3;  /* Mantener si es un azul específico para notas */
            --cft-naranjo-notas: #f15a24; /* Mantener si es un naranja específico para notas */
            --cft-gris-claro-notas: #f5f5f5; /* Mantener si es un gris específico para notas */
            --cft-gris-medio-notas: #e0e0e0; /* Mantener si es un gris específico para notas */
            --cft-texto-notas: #333333; /* Mantener si es un texto específico para notas */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            line-height: 1.6;
            color: var(--color-texto);
            background-image: url('https://cftdelosrios.cl/wp-content/uploads/2024/08/Sede-Paillaco-e1741632105401-1024x1024.jpeg'); /* Placeholder for Sede-Paillaco-e1741632105401.jpg */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: rgba(255, 255, 255, 0.95);
            padding: var(--espaciado-md);
            border-bottom: 1px solid #eee;
            box-shadow: var(--sombra-suave);
        }

        .content-section, .modal-content, .module-card, .profile-detail-card {
            background-color: rgba(255, 255, 255, 0.9);
            padding: var(--espaciado-lg);
            border-radius: var(--borde-radio);
            box-shadow: var(--sombra-suave);
            margin-bottom: var(--espaciado-md);
            text-align: center;
        }

        /* ====================================================================
           SECCIÓN: CONTENEDOR PRINCIPAL
           ====================================================================
        */
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--espaciado-md);
        }

        /* ====================================================================
           SECCIÓN: ENCABEZADO (HEADER) Y NAVEGACIÓN
           Descripción: Estilos para el logo, la barra de navegación y el menú de perfil.
           ====================================================================
        */
        header .container {
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }

        .logo {
            font-size: 1.8em;
            font-weight: 600;
            color: var(--color-primario);
            text-decoration: none;
            display: flex;
            align-items: center;
            margin-right: var(--espaciado-md);
        }
        
        .logo img {
            max-height: 50px;
            width: auto;
            margin-right: 10px;
        }

        nav {
            flex-grow: 1;
        }

        nav ul {
            list-style: none;
            display: flex;
            align-items: center;
            padding: 0;
            margin: 0;
            width: 100%;
        }

        #profile-nav-link {
            position: relative;
            display: none; /* Controlado por JS para mostrar/ocultar */
            margin-left: auto; /* Empuja el perfil a la derecha en desktop */
        }
        
        /* Dropdown de Perfil (Solo en Desktop) */
        .profile-dropdown-content {
            display: none; /* Oculto por defecto */
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            min-width: 180px;
            box-shadow: var(--sombra-suave);
            z-index: 10;
            right: 0;
            top: calc(100% + 5px);
            border-radius: var(--borde-radio);
            overflow: hidden;
            animation: fadeInScaleUp var(--animation-duration) ease-out forwards;
            transform-origin: top right;
            padding: 10px 0;
        }

        .profile-dropdown-content.show {
            display: block;
        }

        .profile-dropdown-content .dropdown-header {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 5px;
        }

        .profile-dropdown-content #dropdown-profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            border: 2px solid var(--color-primario);
        }

        .profile-dropdown-content #dropdown-username {
            font-weight: 600;
            color: var(--color-primario);
            font-size: 1em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: calc(100% - 50px);
        }

        .profile-dropdown-content a {
            color: var(--color-texto);
            padding: 8px 15px;
            text-decoration: none;
            display: block;
            font-size: 0.95em;
            transition: background-color var(--animation-duration) ease;
        }

        .profile-dropdown-content a:hover {
            background-color: var(--color-secundario);
        }

        nav ul li a.btn-nav-link {
            background-color: var(--color-secundario);
            color: var(--color-texto);
            padding: 8px 15px;
            border-radius: var(--borde-radio);
            transition: background-color var(--animation-duration) ease, color var(--animation-duration) ease;
        }
        nav ul li a.btn-nav-link:hover {
            background-color: var(--color-primario);
            color: #fff;
        }

        nav ul li a:hover {
            color: var(--color-primario);
        }

        #nav-profile-pic {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--color-primario);
            transition: border-color var(--animation-duration) ease, transform 0.2s ease;
            cursor: pointer;
        }
        #nav-profile-pic:hover {
            border-color: #004085;
            transform: scale(1.05);
        }

        /* Oculta el botón de menú móvil por defecto */
        .menu-toggle {
            display: none; 
            font-size: 2em;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--color-primario);
            margin-left: auto;
        }

        /* ====================================================================
           SECCIÓN: CONTENIDO PRINCIPAL Y BOTONES
           Descripción: Estilos para las secciones de contenido, el botón de retroceso
                        y los botones de acción principales.
           ====================================================================
        */
        main {
            flex-grow: 1;
            padding: var(--espaciado-lg) 0;
        }

        .content-section {
            display: none;
            position: relative;
        }
        .content-section.active-section {
            display: block;
            animation: fadeIn 0.8s ease-out forwards;
        }

        .content-section h1 {
            color: var(--color-primario);
            margin-bottom: var(--espaciado-md);
            font-size: 2.2em;
        }

        .content-section p {
            color: var(--color-texto-claro);
            font-size: 1.1em;
            margin-bottom: var(--espaciado-md);
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: var(--color-secundario);
            color: var(--color-texto);
            border: none;
            border-radius: var(--borde-radio);
            padding: 8px 15px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color var(--animation-duration) ease, color var(--animation-duration) ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: var(--sombra-suave);
        }

        .back-button:hover {
            background-color: var(--color-primario);
            color: #fff;
            transform: translateX(-3px);
        }

        .back-button::before {
            content: '←';
            font-weight: bold;
            font-size: 1.2em;
        }

        .btn-primario, .btn-secundario {
            display: inline-block;
            padding: 12px 25px;
            border-radius: var(--borde-radio);
            text-decoration: none;
            font-weight: 600;
            transition: background-color var(--animation-duration) ease, transform 0.2s ease;
            cursor: pointer;
            margin: 5px;
            border: none;
        }
        .btn-primario {
            background-color: var(--color-primario);
            color: #fff;
        }
        .btn-secundario {
            background-color: #6c757d;
            color: #fff;
        }

        .btn-primario:hover {
            background-color: #004085;
            transform: translateY(-2px);
        }
        .btn-secundario:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        /* ====================================================================
           SECCIÓN: MÓDULOS
           Descripción: Estilos para la cuadrícula de módulos y las tarjetas individuales.
           ====================================================================
        */
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--espaciado-md);
            margin-top: var(--espaciado-lg);
            display: none;
        }
        .modules-grid.active-section {
            display: grid;
            animation: fadeIn 0.8s ease-out forwards;
        }

        .module-card {
            padding: var(--espaciado-md);
            border-radius: var(--borde-radio);
            box-shadow: var(--sombra-suave);
            text-align: center;
            transition: transform var(--animation-duration) ease, background-color var(--animation-duration) ease;
            cursor: pointer;
        }

        .module-card:hover {
            transform: translateY(-5px);
        }

        /* Colores de hover para las tarjetas de módulo */
        .module-card.hover-blue:hover { background-color: var(--color-modulo-azul); color: #fff; }
        .module-card.hover-blue:hover .icon,
        .module-card.hover-blue:hover h3,
        .module-card.hover-blue:hover p { color: #fff; }

        .module-card.hover-orange:hover { background-color: var(--color-modulo-naranja); color: #fff; }
        .module-card.hover-orange:hover .icon,
        .module-card.hover-orange:hover h3,
        .module-card.hover-orange:hover p { color: #fff; }

        .module-card.hover-green:hover { background-color: var(--color-modulo-verde); color: #fff; }
        .module-card.hover-green:hover .icon,
        .module-card.hover-green:hover h3,
        .module-card.hover-green:hover p { color: #fff; }

        .module-card .icon {
            font-size: 3em;
            color: var(--color-primario);
            margin-bottom: 10px;
            transition: color var(--animation-duration) ease;
        }

        .module-card h3 {
            color: var(--color-texto);
            margin-bottom: 5px;
            transition: color var(--animation-duration) ease;
        }

        .module-card p {
            font-size: 0.9em;
            color: var(--color-texto-claro);
            transition: color var(--animation-duration) ease;
        }

        /* ====================================================================
           SECCIÓN: MODAL DE AUTENTICACIÓN (LOGIN/REGISTRO) - INTEGRADO DEL NUEVO CÓDIGO
           ====================================================================
        */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal.show {
            display: flex;
            animation: fadeInOverlay var(--animation-duration) ease-out;
        }

        .modal-content {
            margin: auto;
            background-color: var(--card-background-login); /* Usar variable del nuevo login */
            border-radius: 0.75rem; /* Usar borde-radius del nuevo login */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); /* Usar sombra del nuevo login */
            overflow: hidden;
            width: 90%;
            max-width: 450px;
            position: relative;
            animation: scaleIn var(--animation-duration) ease-out;
            transform: translateY(0); /* Propiedades de animación del nuevo login */
            transition: transform var(--animation-duration) ease-in-out, 
                        box-shadow var(--animation-duration) ease-in-out;
        }
        .modal-content:hover { /* Hover del nuevo login */
            transform: translateY(-5px);
            box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.1);
        }


        .close-button {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
            transition: color var(--animation-duration) ease;
            z-index: 100; /* Asegura que el botón de cierre esté por encima del header */
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--color-texto);
        }
        
        /* Estilos del header del nuevo login */
        .login-header {
            background: linear-gradient(135deg, var(--primary-login-color), var(--secondary-login-color));
            color: white;
            padding: 2rem 2rem 2.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.05),
                rgba(255, 255, 255, 0.05) 20px,
                transparent 20px,
                transparent 40px
            );
            animation: headerPattern 30s linear infinite;
        }

        @keyframes headerPattern {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg);}
        }

        .login-logo {
            position: relative;
            z-index: 1;
            margin-bottom: 1.5rem;
        }

        .logo-circle {
            width: 80px;
            height: 80px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .logo-circle i {
            font-size: 2.5rem;
            color: var(--accent-login-color); /* Naranja para el ícono */
        }

        .login-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: white; /* Ensure title color is white as per new login */
        }

        .login-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            color: white; /* Ensure subtitle color is white as per new login */
        }

        .login-form {
            padding: 2rem;
            text-align: left; /* Align form content to left */
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-group label {
            display: block;
            color: var(--text-login-color); /* Usar variable del nuevo login */
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            transition: color var(--animation-duration) ease;
        }

        .input-group {
            position: relative;
        }

        .input-group input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--input-border-login);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all var(--animation-duration) ease;
            background-color: #f9fafb;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--input-focus-login);
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.2);
            background-color: white;
        }

        .input-group i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-login-color);
            transition: color var(--animation-duration) ease;
        }

        .input-group input:focus + i {
            color: var(--input-focus-login);
        }

        .btn-login {
            width: 100%;
            padding: 0.8rem;
            background: linear-gradient(to right, var(--primary-login-color), var(--secondary-login-color));
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            position: relative;
            overflow: hidden;
            display: flex; /* Para centrar spinner y texto */
            align-items: center;
            justify-content: center;
        }

        .btn-login::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            transition: all 0.6s ease;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }

        .btn-login:active {
            transform: translateY(0);
        }
        
        .forgot-password {
            text-align: center;
            margin-top: 1rem;
        }
        
        .forgot-password a {
            color: var(--accent-login-color); /* Naranja para el enlace */
            text-decoration: none;
            font-size: 0.875rem;
            transition: color var(--animation-duration) ease;
        }
        
        .forgot-password a:hover {
            color: var(--primary-login-color); /* Verde al hacer hover */
        }

        .modal-content p.message {
            margin-top: 15px;
            font-size: 0.9em;
            color: var(--color-texto-claro); /* Usar variable original */
            text-align: center;
        }

        .modal-content p.message a {
            color: var(--primary-login-color); /* Usar variable del nuevo login */
            text-decoration: none;
            font-weight: 600;
        }
        
        .login-footer {
            text-align: center;
            padding: 1.5rem 2rem; /* Añadir padding para que no se pegue al fondo */
            color: var(--text-login-color); /* Usar variable del nuevo login */
            font-size: 0.875rem;
            border-top: 1px solid var(--input-border-login); /* Separador */
        }
        
        .login-footer span {
            opacity: 0.8;
        }

        /* Notificaciones (del nuevo login) */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateX(150%);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            display: flex;
            align-items: center;
            max-width: 400px;
        }
        
        .notification i {
            margin-right: 0.75rem;
            font-size: 1.25rem;
        }
        
        .notification.error {
            background-color: #FEF2F2;
            border-left: 4px solid var(--error-login-color);
            color: var(--error-login-color);
        }
        
        .notification.success {
            background-color: #ECFDF5;
            border-left: 4px solid var(--success-login-color);
            color: var(--success-login-color);
        }
        
        .notification.show {
            transform: translateX(0);
        }

        /* Loading spinner (del nuevo login) */
        .loading-spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            margin-right: 0.5rem;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            display: none;
        }
        
        .btn-login.loading .loading-spinner {
            display: inline-block;
        }
        
        @keyframes spin {
            to {transform: rotate(360deg);}
        }

        /* Form shake animation (del nuevo login) */
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            10%, 30%, 50%, 70%, 90% {transform: translateX(-5px);}
            20%, 40%, 60%, 80% {transform: translateX(5px);}
        }
        
        .shake {
            animation: shake 0.6s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
        }

        /* Success animation (del nuevo login) */
        @keyframes success-pulse {
            0% {transform: scale(1);}
            50% {transform: scale(1.05);}
            100% {transform: scale(1);}
        }
        
        .success-pulse {
            animation: success-pulse 0.5s ease-in-out;
        }


        /* ====================================================================
           SECCIÓN: PERFIL DETALLADO
           Descripción: Estilos para la sección de edición y visualización del perfil.
           ====================================================================
        */
        .profile-detail-card {
            max-width: 600px;
            margin: 0 auto;
            text-align: left;
        }

        .profile-detail-card h2 {
            color: var(--color-primario);
            margin-bottom: var(--espaciado-md);
            font-size: 1.8em;
            text-align: center;
        }

        .profile-detail-card .form-group {
            margin-bottom: 15px;
        }

        .profile-detail-card label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--color-texto);
        }

        .profile-detail-card input[type="text"],
        .profile-detail-card input[type="email"],
        .profile-detail-card input[type="tel"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--borde-radio);
            font-size: 1em;
        }

        .profile-detail-card .button-group {
            text-align: center;
            margin-top: 20px;
        }

        .profile-pic-container {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        #profile-pic {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--color-primario);
            cursor: pointer;
            transition: border-color var(--animation-duration) ease, transform 0.2s ease;
        }

        #profile-pic:hover {
            border-color: #004085;
            transform: scale(1.03);
        }

        #profile-image-upload {
            display: none;
        }

        .btn-delete-pic {
            background-color: var(--color-error);
            color: #fff;
            padding: 8px 15px;
            border-radius: var(--borde-radio);
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color var(--animation-duration) ease;
            margin-top: 10px;
        }
        .btn-delete-pic:hover {
            background-color: #a71d2a;
        }


        /* ====================================================================
           SECCIÓN: PIE DE PÁGINA (FOOTER)
           ====================================================================
        */
        footer {
            background-color: var(--color-texto);
            color: #fff;
            text-align: center;
            padding: var(--espaciado-md);
            margin-top: auto;
        }

        /* ====================================================================
           SECCIÓN: ESTILOS ESPECÍFICOS DEL CALENDARIO / HORARIO DE CLASES
           ====================================================================
        */
        .schedule-container {
            background-color: #ffffff;
            border-radius: 12px; /* Esquinas redondeadas para el contenedor principal */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Sombra suave */
            padding: 2rem;
            max-width: 1200px;
            width: 100%;
            overflow-x: auto; /* Permite el scroll horizontal en pantallas pequeñas */
            margin: 0 auto; /* Centrar el contenedor del horario */
            margin-top: var(--espaciado-md); /* Espacio superior */
        }
        .schedule-container h1 {
            color: #1a202c; /* Color de texto más oscuro para el título del horario */
        }
        table {
            width: 100%;
            border-collapse: separate; /* Permite bordes redondeados en las celdas */
            border-spacing: 0;
            min-width: 900px; /* Asegura que la tabla no sea demasiado pequeña en pantallas estrechas */
            margin: 0 auto; /* Centrar la tabla */
        }
        th, td {
            padding: 1rem;
            text-align: center;
            border: 1px solid #e2e8f0; /* Borde suave para las celdas */
        }
        th {
            background-color: #2a61a7; /* Color de encabezado que coincide con el de la imagen */
            color: #ffffff;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tr:nth-child(even) {
            background-color: #f8fafc; /* Color de fila par */
        }
        .time-slot {
            background-color: #f0f4f8; /* Color de fondo para las horas */
            font-weight: 500;
            color: #4a5568;
        }
        .subject-cell {
            background-color: #10B981; /* Verde esmeralda para las asignaturas */
            color: #ffffff;
            font-weight: 600;
            border-radius: 8px; /* Esquinas redondeadas para las celdas de asignatura */
            padding: 0.75rem;
            margin: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%; /* Asegura que la celda de asignatura ocupe todo el espacio disponible */
            box-sizing: border-box;
        }
        /* Estilos responsivos para el calendario usando Tailwind CSS */
        @media (max-width: 768px) {
            .schedule-container {
                padding: 1rem;
            }
            th, td {
                padding: 0.75rem;
                font-size: 0.875rem; /* Reduce el tamaño de fuente en pantallas pequeñas */
            }
            .subject-cell {
                font-size: 0.75rem;
                padding: 0.5rem;
            }
        }

        /* ====================================================================
           SECCIÓN: ANIMACIONES CSS
           ====================================================================
        */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeInScaleUp {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* ====================================================================
           SECCIÓN: DISEÑO RESPONSIVO (MOBILE FIRST - max-width)
           Descripción: Ajustes de diseño para pantallas de hasta 768px de ancho.
                        Aquí se gestiona el menú móvil y cómo se muestran los
                        elementos de perfil en la navegación.
           ====================================================================
        */
        @media (max-width: 768px) {
            header .container {
                flex-direction: column;
                align-items: flex-start;
            }

            .logo {
                margin-right: 0; 
                margin-bottom: 10px; 
            }

            /* El botón de menú móvil ahora solo se muestra si el body tiene la clase 'logged-in' */
            body.logged-in .menu-toggle {
                display: block; /* Muestra el botón de menú móvil */
                align-self: flex-end; /* Lo alinea a la derecha del header en móvil */
            }

            nav {
                width: 100%;
                margin-top: var(--espaciado-md);
                margin-left: 0; 
            }

            nav ul {
                flex-direction: column;
                display: none; /* Oculto por defecto en móvil, mostrado con .active */
                width: 100%;
                text-align: center;
                gap: 10px; 
                background-color: rgba(255, 255, 255, 0.98); 
                padding: 15px 0;
                border-radius: var(--borde-radio);
                box-shadow: var(--sombra-suave);
            }

            nav ul.active {
                display: flex; /* Muestra el menú cuando está activo */
                align-items: center; 
                justify-content: center; 
            }

            /* Resetea el margin-left: auto para el perfil en móvil */
            #profile-nav-link {
                margin-left: 0 !important;
                width: 100%;
                display: block !important; 
            }
            
            /* Ocultar la pequeña foto de perfil en la barra de navegación cuando el menú móvil está activo */
            #profile-nav-link > a { 
                display: none !important; 
            }

            /* Transforma el .profile-dropdown-content para que sus enlaces sean elementos
               directos del menú móvil.
            */
            .profile-dropdown-content {
                position: static !important; /* Desactiva el posicionamiento absoluto */
                display: block !important; /* Fuerza a que el contenido se muestre como bloque */
                width: 100%; /* Ocupa todo el ancho */
                box-shadow: none !important; /* Elimina la sombra */
                border-radius: 0 !important; /* Elimina bordes redondeados */
                padding: 0 !important; /* Elimina padding, los 'a' tendrán su propio padding */
                background-color: transparent !important; /* Fondo transparente */
                margin-top: 0; /* Elimina margen superior */
            }
            
            /* Ocultar el encabezado del dropdown (foto y nombre) en el menú móvil */
            .profile-dropdown-content .dropdown-header {
                display: none !important; 
            }

            /* Estilos para los enlaces "Ver Perfil Completo" y "Cerrar Sesión" en el menú móvil */
            .profile-dropdown-content a {
                color: var(--color-texto);
                padding: 10px 20px;
                text-decoration: none;
                display: block;
                font-size: 1em;
                transition: background-color var(--animation-duration) ease;
                border-bottom: 1px solid #eee; /* Separador entre enlaces */
            }
            .profile-dropdown-content a:last-child {
                border-bottom: none;
            }
            .profile-dropdown-content a:hover {
                background-color: var(--color-primario);
                color: #fff;
            }

            .back-button {
                top: 15px;
                left: 15px;
                font-size: 0.9em;
                padding: 6px 12px;
            }

            /* Responsive adjustments for new login (from the provided code) */
            @media (max-width: 500px) {
                .modal-content { /* Renamed from .login-container */
                    max-width: 100%;
                }
                
                .login-header {
                    padding: 1.5rem 1.5rem 2rem;
                }
                
                .login-form {
                    padding: 1.5rem;
                }
                
                .notification {
                    top: 1rem;
                    right: 1rem;
                    left: 1rem;
                    max-width: unset;
                }
            }
        }

        /* Estilos específicos para el directorio y el modal de detalles C++-like */
        .directory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: var(--espaciado-lg);
            text-align: left; /* Alinea el texto a la izquierda para los elementos del directorio */
        }

        .directory-card {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--sombra-suave);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #e0e0e0;
        }

        .directory-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .directory-card .icon {
            font-size: 2.5em;
            color: var(--color-primario);
        }

        .directory-card h3 {
            font-size: 1.4em;
            color: var(--color-texto);
            margin-bottom: 5px;
        }

        .directory-card p {
            font-size: 0.9em;
            color: var(--color-texto-claro);
        }

        /* Estilos para los títulos de las sedes dentro del directorio */
        .sede-title {
            grid-column: 1 / -1; /* Ocupa todo el ancho de la cuadrícula */
            text-align: left;
            font-size: 1.8em;
            font-weight: 700;
            color: var(--color-primario);
            margin-top: 25px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--color-primario);
        }

        /* Modal de detalles de contacto (diseño normal, no C++-like) */
        #contact-details-modal .modal-content {
            background-color: #ffffff; /* Fondo blanco */
            color: var(--color-texto); /* Texto normal */
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px; /* Reducir el ancho máximo para un mejor aspecto */
            position: relative;
            font-family: 'Inter', sans-serif;
            text-align: left;
            animation: fadeInScaleUp 0.3s ease-out forwards;
        }

        #contact-details-modal .close-button {
            color: #aaa;
            top: 15px;
            right: 20px;
        }
        #contact-details-modal .close-button:hover {
            color: var(--color-texto);
        }

        #contact-details-modal h2 {
            color: var(--color-primario); /* Azul primario para el título */
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 1px solid #eee; /* Separador suave */
            padding-bottom: 10px;
        }

        #contact-details-modal p {
            margin-bottom: 10px;
            font-size: 1.1em;
            color: var(--color-texto);
        }
        #contact-details-modal p strong {
            color: var(--color-primario); /* Resaltar las etiquetas */
            margin-right: 5px;
        }
        #contact-details-modal a {
            color: var(--color-modulo-azul); /* Color de enlace para correos/teléfonos */
            text-decoration: underline;
        }
        
        /* New styles from notas.txt for the performance section, adapted to existing theme variables */
        .dashboard-title {
            margin: 30px 0 20px;
            color: var(--color-primario); /* Using primary color */
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .materias-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Adjustments for 3x2 layout and smaller elements within materia-card */
        @media (min-width: 992px) { /* Adjust for larger screens to fit 3 columns */
            .materias-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .materias-grid.active-section {
                grid-template-columns: repeat(3, 1fr); /* Ensure 3 columns when active */
            }
        }

        @media (max-width: 991px) and (min-width: 769px) { /* Adjust for tablets to fit 2 columns */
            .materias-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .materias-grid.active-section {
                grid-template-columns: repeat(2, 1fr); /* Ensure 2 columns when active */
            }
        }

        @media (max-width: 768px) { /* Keep 1 column for mobile */
            .materias-grid {
                grid-template-columns: 1fr;
            }
            .materias-grid.active-section {
                grid-template-columns: 1fr; /* Ensure 1 column when active */
            }
        }
        
        .materia-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--sombra-suave); /* Using existing shadow variable */
            transition: transform 0.3s ease;
            opacity: 0; /* Initial state for animation */
            transform: translateY(20px); /* Initial state for animation */
        }
        
        .materia-card:hover {
            transform: translateY(-5px);
        }
        
        .materia-header {
            background-color: var(--color-primario); /* Using primary color */
            color: white;
            padding: 15px 20px;
            font-size: 0.9em; /* Smaller header font */
        }
        .materia-header h3 {
            font-size: 1.1em; /* Adjust h3 size within header */
        }
        
        .materia-content {
            padding: 15px; /* Reduced padding */
        }
        
        .unidades-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px; /* Reduced gap */
        }
        
        .unidad {
            background-color: var(--color-secundario); /* Using secondary color */
            padding: 10px; /* Reduced padding */
            border-radius: 8px;
        }
        
        .unidad h4 {
            color: var(--color-primario); /* Using primary color */
            margin-bottom: 8px; /* Reduced margin */
            display: flex;
            justify-content: space-between;
            font-size: 0.9em; /* Smaller unit title font */
        }
        .unidad h4 span {
            font-size: 0.8em; /* Smaller attendance percentage */
        }
        
        .notas-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px; /* Reduced margin */
        }
        
        .nota {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .nota-label {
            font-size: 0.7em; /* Smaller label font */
            color: var(--color-texto-claro); /* Using existing text color */
            margin-bottom: 3px; /* Reduced margin */
        }
        
        .nota-value {
            font-weight: bold;
            font-size: 0.9em; /* Smaller note value font */
            width: 35px; /* Smaller circle */
            height: 35px; /* Smaller circle */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: var(--color-exito); /* Default green, will be overridden by JS */
            color: white;
        }
        
        .promedio-container {
            background-color: rgba(241, 90, 36, 0.1); /* Using a softer orange tint */
            padding: 8px; /* Reduced padding */
            border-radius: 8px;
            margin-top: 8px; /* Reduced margin */
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em; /* Smaller promedio font */
        }
        
        .promedio-label {
            font-weight: bold;
            color: var(--accent-login-color); /* Using accent orange */
        }
        
        .promedio-value {
            font-weight: bold;
            font-size: 1.1em; /* Slightly smaller promedio value font */
            color: var(--accent-login-color); /* Using accent orange */
        }
        
        .asistencia {
            background-color: white;
            border-top: 1px solid var(--color-secundario); /* Using secondary color for border */
            padding: 10px 15px; /* Reduced padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em; /* Smaller attendance text */
        }
        
        .asistencia-value {
            font-weight: bold;
            color: var(--color-exito); /* Using success green */
        }
        
        .progress-bar {
            height: 6px; /* Reduced height */
            background-color: var(--color-secundario); /* Using secondary color */
            border-radius: 4px;
            margin-top: 5px; /* Reduced margin */
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--color-exito); /* Using success green */
            border-radius: 4px;
        }

        /* Styles from becas.txt, adapted */
        #scholarships-section .beca-item {
            border: 1px solid #ddd;
            border-radius: 8px; /* Using var(--borde-radio) */
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: var(--sombra-suave); /* Using existing shadow */
        }
        #scholarships-section .beca-header {
            background-color: var(--color-modulo-azul); /* Mapped from #007bff */
            color: white;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top-left-radius: 8px; /* Ensure rounded corners */
            border-top-right-radius: 8px;
        }
        #scholarships-section .beca-header h3 {
            margin: 0;
            color: white;
            font-size: 1.1em; /* Adjusted for consistency */
        }
        #scholarships-section .beca-content {
            padding: 15px;
            background-color: var(--color-secundario); /* Mapped from #f9f9f9 */
            display: none;
            text-align: left; /* Align content to left */
            border-bottom-left-radius: 8px; /* Ensure rounded corners */
            border-bottom-right-radius: 8px;
        }
        #scholarships-section .beca-content p {
            margin-bottom: 10px;
            font-size: 0.95em; /* Adjusted for consistency */
            color: var(--color-texto); /* Using main text color */
        }
        #scholarships-section .beca-content ul {
            list-style-type: disc;
            margin-left: 20px;
            padding-left: 0; /* Reset default padding */
            margin-top: 10px;
            color: var(--color-texto);
        }
        #scholarships-section .beca-content li {
            margin-bottom: 5px;
            font-size: 0.95em;
        }
        #scholarships-section .toggle-icon {
            font-size: 1.2em; /* Icono para expandir/colapsar */
            font-weight: bold;
        }
        #scholarships-section .highlight {
            background-color: #e6f7ff; /* Keeping original light blue */
            padding: 15px;
            border-left: 5px solid var(--color-modulo-azul); /* Mapped from #007bff */
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: left; /* Align text to left */
        }
        #scholarships-section .highlight h2 {
            font-size: 1.5em; /* Adjusted for consistency */
            color: var(--color-primario); /* Using primary color */
            margin-bottom: 10px;
        }
        #scholarships-section .highlight ul {
            list-style-type: disc;
            margin-left: 20px;
            padding-left: 0;
            margin-top: 5px;
            color: var(--color-texto);
        }
        #scholarships-section a {
            color: var(--color-modulo-azul); /* Mapped from #007bff */
            text-decoration: none;
            transition: text-decoration 0.2s ease;
        }
        #scholarships-section a:hover {
            text-decoration: underline;
        }


    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="#" class="logo" data-section="main-menu">
                <img src="https://cftdelosrios.cl/wp-content/uploads/2021/09/cropped-Recurso-2.png" alt="Logo CFT Los Ríos"> <!-- Placeholder for cropped-Recurso-2.png -->
            </a>
            <button class="menu-toggle" aria-label="Abrir menú">&#9776;</button>
            <nav>
                <ul>
                    <li><a href="https://cftdelosrios.cl/" target="_blank" class="btn-nav-link">Página Oficial</a></li>
                    
                    <li id="profile-nav-link" style="display: none;">
                        <a href="#"> 
                            <img id="nav-profile-pic" src="https://placehold.co/35x35/D3D3D3/000?text=Avatar" alt="Mi Perfil"> <!-- Placeholder for default-avatar.png -->
                        </a>
                        <div id="profile-dropdown" class="profile-dropdown-content">
                            <div class="dropdown-header">
                                <img id="dropdown-profile-pic" src="https://placehold.co/40x40/D3D3D3/000?text=Avatar" alt="Foto de Perfil"> <!-- Placeholder for default-avatar.png -->
                                <span id="dropdown-username"></span>
                            </div>
                            <a href="#" data-section="user-profile-detail">Ver Perfil Completo</a>
                            <a href="#" data-action="logout">Cerrar Sesión</a>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <section id="home-section" class="content-section active-section">
                <h1>Bienvenido, CFTINO!</h1>
                <p>Tu portal de CFT viene mas cerca que nunca.</p>
                <button class="btn-primario" data-action="open-login-modal">Iniciar Sesión</button>
            </section>

            <section id="profile-section" class="content-section" style="display: none;">
                <h1>Mi Perfil</h1>
                <p>Bienvenido/a, <span id="user-email-display"></span>!</p>
                <p>Aquí verás tus datos personales y otra información.</p>
            </section>

            <section id="user-profile-detail-section" class="content-section">
                <button class="back-button" data-target-section="modules">Volver</button>
                <div class="profile-detail-card">
                    <h2>Detalles de mi Perfil</h2>
                    <form id="profile-form">
                        <div class="profile-pic-container">
                            <img id="profile-pic" src="https://placehold.co/120x120/D3D3D3/000?text=Avatar" alt="Foto de Perfil"> <!-- Placeholder for default-avatar.png -->
                            <input type="file" id="profile-image-upload" accept="image/*">
                            <br>
                            <button type="button" class="btn-delete-pic" id="delete-profile-pic-btn" style="display:none;">Eliminar Foto</button>
                        </div>

                        <div class="form-group">
                            <label for="profile-name">Nombre Completo:</label>
                            <input type="text" id="profile-name" value="Nombre del Estudiante" disabled>
                        </div>
                        <div class="form-group">
                            <label for="profile-email">Correo Electrónico:</label>
                            <input type="email" id="profile-email" value="estudiante@cftlosrios.cl" disabled>
                        </div>
                        <div class="form-group">
                            <label for="profile-phone">Número de Teléfono:</label>
                            <input type="tel" id="profile-phone" value="+56 9 1234 5678" disabled>
                        </div>
                        <div class="form-group">
                            <label for="profile-rut">RUT Chileno:</label>
                            <input type="text" id="profile-rut" value="12.345.678-K" disabled placeholder="Ej: 12.345.678-K">
                            <small style="color: var(--color-texto-claro);">Este campo es solo decorativo y no se validará.</small>
                        </div>
                        <div class="button-group">
                            <button type="button" class="btn-primario" id="edit-profile-btn">Editar Perfil</button>
                            <button type="submit" class="btn-primario" id="save-profile-btn" style="display: none;">Guardar Cambios</button>
                            <button type="button" class="btn-secundario" id="cancel-edit-btn" style="display: none;">Cancelar</button>
                        </div>
                        <p id="profile-message" style="margin-top: 15px;"></p>
                    </form>
                </div>
            </section>

            <section id="modules-section" class="modules-grid">
                 <div class="module-card hover-blue" data-section="notes-attendance">
                    <span class="icon">&#128220;</span> <h3>Notas y Asistencia</h3>
                    <p>Accede rápidamente a tus calificaciones y registro de asistencia.</p>
                </div>
                <div class="module-card hover-orange" data-section="academic-calendar">
                    <span class="icon">&#128197;</span> <h3>Calendario Académico</h3>
                    <p>Mantente al día con los eventos y fechas importantes.</p>
                </div>
                <div class="module-card hover-green" data-section="notifications">
                    <span class="icon">&#128276;</span> <h3>Notificaciones</h3>
                    <p>Revisa avisos y comunicados importantes del sistema.</p>
                </div>
                <div class="module-card hover-blue" data-section="directory">
                    <span class="icon">&#128204;</span> <h3>Directorio</h3>
                    <p>Encuentra información de docentes y personal administrativo.</p>
                </div>
                <div class="module-card hover-orange" data-section="scholarships">
                    <span class="icon">&#128188;</span> <h3>Becas y Beneficios</h3>
                    <p>Información relevante sobre ayudas económicas.</p>
                </div>
                <div class="module-card hover-green" data-section="report-issue">
                    <span class="icon">&#128736;</span> <h3>Reportar Problema</h3>
                    <p>Ayúdanos a mejorar reportando cualquier error del sistema.</p>
                </div>
            </section>

            <section id="notes-attendance-section" class="content-section">
                <button class="back-button" data-target-section="modules">Volver</button>
                <h1 class="dashboard-title"><i class="fas fa-book-open"></i> Rendimiento Académico</h1>
                
                <div class="materias-grid">
                    <!-- Materia 1 -->
                    <div class="materia-card">
                        <div class="materia-header">
                            <h3><i class="fas fa-calculator"></i> Nivelación de Matemáticas</h3>
                        </div>
                        <div class="materia-content">
                            <div class="unidades-container">
                                <div class="unidad">
                                    <h4>Unidad 1 <span>Asistencia: 82.3%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">4.5</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">5.2</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">4.85</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 2 <span>Asistencia: 89.7%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">5.8</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">6.3</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.05</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 3 <span>Asistencia: 76.5%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">3.9</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">4.7</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">4.30</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 4 <span>Asistencia: 94.2%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">6.2</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">5.8</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="asistencia">
                            <span>Asistencia Total:</span>
                            <span class="asistencia-value">85.7%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 85.7%"></div>
                        </div>
                    </div>
                    
                    <!-- Materia 2 -->
                    <div class="materia-card">
                        <div class="materia-header">
                            <h3><i class="fas fa-laptop-code"></i> Introducción a Programación</h3>
                        </div>
                        <div class="materia-content">
                            <div class="unidades-container">
                                <div class="unidad">
                                    <h4>Unidad 1 <span>Asistencia: 95.8%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">6.5</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">7.0</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.75</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 2 <span>Asistencia: 98.4%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">7.0</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">6.9</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.95</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 3 <span>Asistencia: 92.1%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">5.7</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">6.8</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.25</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 4 <span>Asistencia: 99.0%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">6.9</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">7.0</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.95</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="asistencia">
                            <span>Asistencia Total:</span>
                            <span class="asistencia-value">96.3%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 96.3%"></div>
                        </div>
                    </div>
                    
                    <!-- Materia 3 -->
                    <div class="materia-card">
                        <div class="materia-header">
                            <h3><i class="fas fa-chart-line"></i> Fundamentos de Data Science</h3>
                        </div>
                        <div class="materia-content">
                            <div class="unidades-container">
                                <div class="unidad">
                                    <h4>Unidad 1 <span>Asistencia: 78.9%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">3.5</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">4.1</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">3.80</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 2 <span>Asistencia: 85.3%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">5.0</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">6.0</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">5.50</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 3 <span>Asistencia: 91.7%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">6.5</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">5.8</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.15</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 4 <span>Asistencia: 96.5%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">6.8</span>
                                            </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">7.0</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.90</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="asistencia">
                            <span>Asistencia Total:</span>
                            <span class="asistencia-value">88.1%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 88.1%"></div>
                        </div>
                    </div>
                    
                    <!-- Materia 4 -->
                    <div class="materia-card">
                        <div class="materia-header">
                            <h3><i class="fas fa-briefcase"></i> Apresto Laboral</h3>
                        </div>
                        <div class="materia-content">
                            <div class="unidades-container">
                                <div class="unidad">
                                    <h4>Unidad 1 <span>Asistencia: 83.4%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">4.0</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">5.0</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">4.50</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 2 <span>Asistencia: 88.9%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">5.5</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">6.1</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">5.80</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 3 <span>Asistencia: 94.7%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">6.2</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">7.0</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.60</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 4 <span>Asistencia: 97.3%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">6.5</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">6.8</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.65</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="asistencia">
                            <span>Asistencia Total:</span>
                            <span class="asistencia-value">91.1%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 91.1%"></div>
                        </div>
                    </div>
                    
                    <!-- Materia 5 -->
                    <div class="materia-card">
                        <div class="materia-header">
                            <h3><i class="fas fa-language"></i> Inglés I</h3>
                        </div>
                        <div class="materia-content">
                            <div class="unidades-container">
                                <div class="unidad">
                                    <h4>Unidad 1 <span>Asistencia: 86.2%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">5.2</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">4.8</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">5.00</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 2 <span>Asistencia: 80.5%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">4.0</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">4.6</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">4.30</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 3 <span>Asistencia: 98.9%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">6.7</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">7.0</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.85</span>
                                    </div>
                                </div>
                                <div class="unidad">
                                    <h4>Unidad 4 <span>Asistencia: 100%</span></h4>
                                    <div class="notas-container">
                                        <div class="nota">
                                            <span class="nota-label">Nota 1</span>
                                            <span class="nota-value">7.0</span>
                                        </div>
                                        <div class="nota">
                                            <span class="nota-label">Nota 2</span>
                                            <span class="nota-value">6.9</span>
                                        </div>
                                    </div>
                                    <div class="promedio-container">
                                        <span class="promedio-label">Promedio:</span>
                                        <span class="promedio-value">6.95</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="asistencia">
                            <span>Asistencia Total:</span>
                            <span class="asistencia-value">91.4%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 91.4%"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="academic-calendar-section" class="content-section">
                <button class="back-button" data-target-section="modules">Volver</button>
                <!-- Contenido del Calendario Académico -->
                <div class="schedule-container rounded-lg">
                    <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">Horario de Clases</h1>
                    <table class="min-w-full bg-white rounded-lg overflow-hidden">
                        <thead class="bg-blue-800 text-white">
                            <tr>
                                <th class="py-3 px-4 rounded-tl-lg">Mod</th>
                                <th class="py-3 px-4">Hora</th>
                                <th class="py-3 px-4">Lunes</th>
                                <th class="py-3 px-4">Martes</th>
                                <th class="py-3 px-4">Miércoles</th>
                                <th class="py-3 px-4">Jueves</th>
                                <th class="py-3 px-4 rounded-tr-lg">Viernes</th>
                                <!-- Sábado y Domingo no tienen clases según el horario, así que se omiten o se dejan vacíos -->
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Mod 1 -->
                            <tr>
                                <td class="time-slot rounded-bl-lg">1</td>
                                <td class="time-slot">08:30-09:15</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <!-- Mod 2 -->
                            <tr>
                                <td class="time-slot">2</td>
                                <td class="time-slot">09:15-10:00</td>
                                <td><div class="subject-cell">TALLER DE APRESTO LABORAL</div></td>
                                <td><div class="subject-cell">NIVELACIÓN DE MATEMÁTICAS</div></td>
                                <td></td>
                                <td><div class="subject-cell">INTRODUCCIÓN A LA PROGRAMACIÓN</div></td>
                                <td></td>
                            </tr>
                            <!-- Mod 3 -->
                            <tr>
                                <td class="time-slot">3</td>
                                <td class="time-slot">10:15-11:00</td>
                                <td><div class="subject-cell">TALLER DE APRESTO LABORAL</div></td>
                                <td><div class="subject-cell">NIVELACIÓN DE MATEMÁTICAS</div></td>
                                <td></td>
                                <td><div class="subject-cell">INTRODUCCIÓN A LA PROGRAMACIÓN</div></td>
                                <td></td>
                            </tr>
                            <!-- Mod 4 -->
                            <tr>
                                <td class="time-slot">4</td>
                                <td class="time-slot">11:00-11:45</td>
                                <td><div class="subject-cell">NIVELACIÓN DE MATEMÁTICAS</div></td>
                                <td></td>
                                <td><div class="subject-cell">TALLER DE APRESTO LABORAL</div></td>
                                <td><div class="subject-cell">INTRODUCCIÓN A LA PROGRAMACIÓN</div></td>
                                <td></td>
                            </tr>
                            <!-- Mod 5 -->
                            <tr>
                                <td class="time-slot">5</td>
                                <td class="time-slot">11:55-12:40</td>
                                <td><div class="subject-cell">NIVELACIÓN DE MATEMÁTICAS</div></td>
                                <td><div class="subject-cell">INTRODUCCIÓN A LA PROGRAMACIÓN</div></td>
                                <td><div class="subject-cell">TALLER DE APRESTO LABORAL</div></td>
                                <td><div class="subject-cell">TIC</div></td>
                                <td></td>
                            </tr>
                            <!-- Mod 6 -->
                            <tr>
                                <td class="time-slot">6</td>
                                <td class="time-slot">12:40-13:20</td>
                                <td></td>
                                <td><div class="subject-cell">INTRODUCCIÓN A LA PROGRAMACIÓN</div></td>
                                <td><div class="subject-cell">FUNDAMENTOS DATA SCIENCE</div></td>
                                <td><div class="subject-cell">TIC</div></td>
                                <td></td>
                            </tr>
                            <!-- Mod 7 -->
                            <tr>
                                <td class="time-slot">7</td>
                                <td class="time-slot">13:35-14:20</td>
                                <td><div class="subject-cell">INGLÉS I</div></td>
                                <td></td>
                                <td><div class="subject-cell">FUNDAMENTOS DATA SCIENCE</div></td>
                                <td><div class="subject-cell">TIC</div></td>
                                <td></td>
                            </tr>
                            <!-- Mod 8 -->
                            <tr>
                                <td class="time-slot">8</td>
                                <td class="time-slot">14:20-15:05</td>
                                <td><div class="subject-cell">INGLÉS I</div></td>
                                <td></td>
                                <td><div class="subject-cell">FUNDAMENTOS DATA SCIENCE</div></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <!-- Mod 9 -->
                            <tr>
                                <td class="time-slot">9</td>
                                <td class="time-slot">15:15-16:00</td>
                                <td><div class="subject-cell">INGLÉS I</div></td>
                                <td></td>
                                <td><div class="subject-cell">FUNDAMENTOS DATA SCIENCE</div></td>
                                <td><div class="subject-cell">INGLÉS I</div></td>
                                <td></td>
                            </tr>
                            <!-- Mod 10 -->
                            <tr>
                                <td class="time-slot">10</td>
                                <td class="time-slot">16:00-16:45</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td><div class="subject-cell">INGLÉS I</div></td>
                                <td></td>
                            </tr>
                            <!-- Resto de módulos sin clases, se mantienen vacíos o se pueden omitir si no son relevantes -->
                            <tr>
                                <td class="time-slot">11</td>
                                <td class="time-slot">16:50-17:35</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="time-slot">12</td>
                                <td class="time-slot">17:35-18:20</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="time-slot">13</td>
                                <td class="time-slot">18:30-19:10</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="time-slot">14</td>
                                <td class="time-slot">19:10-19:50</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="time-slot">15</td>
                                <td class="time-slot">19:50 - 20:30</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="time-slot">16</td>
                                <td class="time-slot">20:30-21:10</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="time-slot">17</td>
                                <td class="time-slot">21:10-21:50</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td class="time-slot rounded-br-lg">18</td>
                                <td class="time-slot">21:50-22:30</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Sección de Notificaciones - Nueva -->
            <section id="notifications-section" class="content-section">
                <button class="back-button" data-target-section="modules">Volver</button>
                <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md border border-gray-200 mx-auto mt-8">
                    <div class="text-center mb-6">
                        <!-- Icono de campana de notificaciones -->
                        <svg class="mx-auto h-16 w-16 text-indigo-500 mb-4 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <h1 class="text-3xl font-extrabold text-gray-800 mb-2">Enviar Notificaciones</h1>
                        <p class="text-gray-600">Envía avisos importantes por correo y SMS.</p>
                    </div>

                    <form id="notificationForm" class="space-y-4">
                        <div>
                            <label for="email_notification" class="block text-sm font-medium text-gray-700 mb-1">Correo Electrónico</label>
                            <input type="email" id="email_notification" name="email_notification" placeholder="tu.correo@ejemplo.com" required
                                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 ease-in-out">
                        </div>
                        <div>
                            <label for="phone_notification" class="block text-sm font-medium text-gray-700 mb-1">Número de Teléfono</label>
                            <input type="tel" id="phone_notification" name="phone_notification" placeholder="+56 9 1234 5678" required
                                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 ease-in-out">
                        </div>
                        <div>
                            <label for="message_notification" class="block text-sm font-medium text-gray-700 mb-1">Mensaje</label>
                            <textarea id="message_notification" name="message_notification" rows="4" placeholder="Escribe tu notificación aquí..." required
                                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 resize-y transition duration-200 ease-in-out"></textarea>
                        </div>

                        <button type="submit"
                                class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold text-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-300 ease-in-out transform hover:scale-105">
                            Enviar Notificación
                        </button>
                    </form>

                    <!-- Área para mostrar mensajes al usuario -->
                    <div id="responseMessageNotification" class="mt-6 p-4 rounded-lg text-center hidden"></div>
                </div>
            </section>

            <!-- Sección de Directorio - NUEVA -->
            <section id="directory-section" class="content-section">
                <button class="back-button" data-target-section="modules">Volver</button>
                <h1>Directorio del CFT Los Ríos</h1>
                <p>Encuentra fácilmente la información de contacto de docentes y personal.</p>
                <!-- Modificación aquí: el directory-list ya no es un grid por si mismo, contendrá los grids por sede -->
                <div id="directory-list">
                    <!-- Los elementos del directorio se cargarán aquí dinámicamente con JavaScript -->
                </div>
            </section>

            <!-- Sección de Becas y Beneficios - NUEVA -->
            <section id="scholarships-section" class="content-section">
                <button class="back-button" data-target-section="modules">Volver</button>
                <h1>Guía de Becas para la Educación Superior en Chile (Ministerio de Educación)</h1>
                <p>¡Hola! Como interesado en la educación superior en Chile, he recopilado la información esencial sobre las becas que ofrece el Ministerio de Educación (Mineduc) para que puedas dar el siguiente paso en tu formación. Esta guía te ayudará a entender los distintos beneficios disponibles para el año académico 2025.</p>

                <div class="highlight">
                    <h2>Puntos Clave para Postular:</h2>
                    <ul>
                        <li>La mayoría de las becas se postulan a través del <a href="https://fuas.cl/" target="_blank">Formulario Único de Acreditación Socioeconómica (FUAS)</a>.</li>
                        <li>Es fundamental tener tu <a href="https://www.registrosocial.gob.cl/" target="_blank">Registro Social de Hogares (RSH)</a> actualizado.</li>
                        <li>Las fechas de postulación son publicadas anualmente por el Mineduc. Revisa constantemente el portal de Beneficios Estudiantiles.</li>
                        <li>La acreditación de la institución y/o carrera es un requisito común.</li>
                    </ul>
                </div>

                <h2>Becas de Arancel del Mineduc</h2>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Gratuidad</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Cubre el 100% del arancel y la matrícula de la carrera, para estudiantes que cumplan con los requisitos socioeconómicos y se matriculen en una institución adscrita.</p>
                        <p><strong>Requisitos principales:</strong></p>
                        <ul>
                            <li>Pertenecer al 60% de los hogares de menores ingresos según el RSH.</li>
                            <li>Estar matriculado en una institución de educación superior adscrita a la Gratuidad.</li>
                            <li>Ser chileno o extranjero con permanencia definitiva/residencia y enseñanza media completa en Chile.</li>
                            <li>No haber excedido la duración formal de la carrera (para estudiantes de cursos superiores).</li>
                        </ul>
                        <p><strong>Monto:</strong> Cubre el 100% del arancel y matrícula referencial.</p>
                        <p><strong>Compatibilidad:</strong> No es compatible con otras becas de arancel del Mineduc.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca Bicentenario (BB)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Apoya el pago de tu carrera en universidades con al menos cuatro años de acreditación.</p>
                        <p><strong>Requisitos principales:</strong></p>
                        <ul>
                            <li>Pertenecer al 70% de la población de menores ingresos según el RSH.</li>
                            <li>Haber obtenido 500 puntos o más en la PAES (o PSU/PDT).</li>
                            <li>Para renovantes: 60% de ramos aprobados en 1er año, 70% desde 2do año.</li>
                            <li>No tener un título profesional o técnico superior.</li>
                        </ul>
                        <p><strong>Monto:</strong> Hasta el 100% del arancel de referencia (varía entre $500.000 y el arancel de referencia máximo).</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca Nuevo Milenio (BNM)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Financia carreras técnico profesionales en CFT o IP acreditados.</p>
                        <p><strong>Requisitos principales:</strong></p>
                        <ul>
                            <li>Pertenecer al 70% de la población de menores ingresos según el RSH.</li>
                            <li>Promedio NEM igual o superior a 5.0 (BNM I) o pertenecer a los deciles 5 y 6 (BNM II).</li>
                        </ul>
                        <p><strong>Monto:</strong> Hasta $600.000 (BNM I) o hasta $860.000 (BNM II) anuales.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca Juan Gómez Millas (BJGM)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Apoyo para financiar tus estudios en cualquier institución de educación superior acreditada.</p>
                        <p><strong>Requisitos principales:</strong></p>
                        <ul>
                            <li>Pertenecer al 70% de la población de menores ingresos según el RSH.</li>
                            <li>Haber obtenido 500 puntos o más en la PAES (o PSU/PDT).</li>
                            <li>No tener un título profesional o técnico superior.</li>
                        </ul>
                        <p><strong>Monto:</strong> Hasta $1.150.000 anuales.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca Vocación de Profesor (BVP)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Cubre el costo total de la carrera de Pedagogía. Varias modalidades:</p>
                        <ul>
                            <li><strong>BVP Pedagogías:</strong> Para estudiantes que ingresan a Pedagogía con alto puntaje PAES (más de 625 puntos).</li>
                            <li><strong>BVP Licenciados y Profesionales:</strong> Para quienes ya tienen un título y quieren formarse como docentes.</li>
                            <li><strong>BVP Licenciaturas:</strong> Para estudiantes renovantes que continúan su formación pedagógica desde una licenciatura.</li>
                        </ul>
                        <p><strong>Monto:</strong> Cubre el costo total de la carrera.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca Distinción a las Trayectorias Educativas (DTE)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Para estudiantes que obtuvieron una de las Distinciones a las Trayectorias Educativas (DTE) en la PAES.</p>
                        <p><strong>Requisitos:</strong> Haber obtenido una DTE en la PAES.</p>
                        <p><strong>Monto:</strong> Financiamiento del arancel de la carrera.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca Excelencia Académica (BEA)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Para estudiantes con las notas más altas de su generación en la enseñanza media.</p>
                        <p><strong>Requisitos:</strong> Pertenecer al 80% de la población de menores ingresos y tener un NEM destacado.</p>
                        <p><strong>Monto:</strong> Varía, ayuda a financiar el arancel.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca Excelencia Técnica (BET)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Apoya a los mejores egresados de Enseñanza Media que ingresan a carreras técnico profesionales.</p>
                        <p><strong>Requisitos:</strong> Pertenecer al 80% de la población de menores ingresos y tener un NEM destacado.</p>
                        <p><strong>Monto:</strong> Varía.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca para Hijas e Hijos de Profesionales de la Educación (BHP)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Para hijos e hijas de profesionales o asistentes de la educación.</p>
                        <p><strong>Requisitos:</strong> Ser hijo/a de profesional o asistente docente con contrato vigente, pertenecer al 80% de menores ingresos, y obtener 500 puntos o más en la PAES (o PSU/PDT).</p>
                        <p><strong>Monto:</strong> Hasta $500.000 anuales.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca de Articulación</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Para quienes tienen un título técnico y desean obtener un título profesional en la misma área.</p>
                        <p><strong>Requisitos:</strong> Tener título técnico de nivel superior, pertenecer al 70% de menores ingresos, y matricularse en carrera profesional afín.</p>
                        <p><strong>Monto:</strong> Varía.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Beca para Estudiantes en Situación de Discapacidad</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Beca especial para estudiantes en situación de discapacidad.</p>
                        <p><strong>Requisitos:</strong> Contar con certificado de discapacidad del RND y cumplir requisitos generales.</p>
                        <p><strong>Monto:</strong> Varía.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Becas de Reparación (Valech I y Valech II)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Para personas en el listado de la Comisión Valech o sus descendientes directos.</p>
                        <p><strong>Requisitos:</strong> Estar en el listado Valech o ser hijo/a/nieto/a de alguien en el listado.</p>
                        <p><strong>Monto:</strong> Cubre el 100% del arancel y matrícula.</p>
                    </div>
                </div>

                <h2>Otros Beneficios Estudiantiles</h2>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Fondo Solidario de Crédito Universitario (FSCU)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Crédito para estudiantes de universidades del Consejo de Rectores.</p>
                        <p><strong>Requisitos:</strong> Pertenecer a los deciles 1 al 8 de ingreso y cumplir con requisitos académicos. Se postula vía FUAS.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Crédito con Garantía Estatal (CAE)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Crédito para financiar estudios en instituciones acreditadas, gestionado por la Comisión Ingresa.</p>
                        <p><strong>Requisitos:</strong> Postulación a través del sitio de Ingresa.cl.</p>
                    </div>
                </div>

                <div class="beca-item">
                    <div class="beca-header" onclick="toggleBeca(this)">
                        <h3>Becas JUNAEB (Mantención y Alimentación)</h3>
                        <span class="toggle-icon">+</span>
                    </div>
                    <div class="beca-content">
                        <p><strong>Descripción:</strong> Aportes económicos para gastos de mantención y alimentación.</p>
                        <ul>
                            <li><strong>Beca de Alimentación para la Educación Superior (BAES):</strong> Tarjeta para comprar alimentos.</li>
                            <li><strong>Beca Indígena (BI):</strong> Para estudiantes de ascendencia indígena.</li>
                            <li><strong>Beca Presidente de la República (BPR):</strong> Para estudiantes con alto rendimiento y bajos recursos.</li>
                            <li><strong>Beca de Mantención para la Educación Superior (BMES):</strong> Aporte en dinero para gastos de mantención.</li>
                        </ul>
                        <p><strong>Postulación:</strong> Generalmente se postulan y/o renuevan a través del Portal de Becas JUNAEB (<a href="https://portalbecas.junaeb.cl/" target="_blank">portalbecas.junaeb.cl</a>).</p>
                    </div>
                </div>

                <h2>¿Cómo Postular?</h2>
                <p>El proceso de postulación a la mayoría de las becas y beneficios del Mineduc comienza con el llenado del <a href="https://fuas.cl/" target="_blank">Formulario Único de Acreditación Socioeconómica (FUAS)</a> en los períodos que el Mineduc define anualmente.</p>
                <p>Una vez completado el FUAS, el Mineduc realiza la preselección y asignación de los beneficios. Es importante estar atento a los resultados y, si es necesario, a los períodos de apelación.</p>

                <h2>Más Información y Contacto</h2>
                <p>Para información oficial y actualizada sobre fechas, requisitos específicos y el estado de tu postulación, te recomiendo visitar los siguientes sitios web:</p>
                <ul>
                    <li><a href="https://portal.beneficiosestudiantiles.cl/" target="_blank">Portal de Beneficios Estudiantiles (Mineduc)</a></li>
                    <li><a href="https://fuas.cl/" target="_blank">FUAS.cl</a></li>
                    <li>Call Center Ayuda Mineduc: <strong>600 600 2626</strong></li>
                    <li><a href="https://www.junaeb.cl/" target="_blank">JUNAEB.cl</a> (para becas de mantención y alimentación)</li>
                </ul>
            </section>

        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 @elwaoo. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Modal de Detalles del Contacto (formato normal) - ACTUALIZADO -->
    <div id="contact-details-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-contact-details-modal">&times;</span>
            <h2 id="contact-details-title"></h2>
            <div id="contact-details-output"></div>
        </div>
    </div>


    <div id="login-modal" class="modal">
        <!-- Contenido del modal de login, integrado del nuevo código -->
        <div class="modal-content" id="loginContainerMain">
            <span class="close-button">&times;</span>
            <div class="login-header">
                <div class="login-logo">
                    <div class="logo-circle">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                </div>
                <h1 class="login-title" id="modal-title">Intranet CFT Los Ríos</h1>
                <p class="login-subtitle">Ingresa tus credenciales para acceder</p>
            </div>
            
            <form class="login-form" id="auth-form">
                <div class="form-group">
                    <label for="email">Correo Electrónico</label>
                    <div class="input-group">
                        <input type="email" id="email" placeholder="usuario@cftrl.cl" required>
                        <i class="fas fa-envelope"></i>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="password">Contraseña (RUT)</label>
                    <div class="input-group">
                        <input type="password" id="password" placeholder="Ingresa tu RUT sin puntos con guión" required>
                        <i class="fas fa-lock"></i>
                    </div>
                </div>
                
                <button class="btn-login" id="loginBtn" type="submit">
                    <span class="loading-spinner"></span>
                    <span class="btn-text">Iniciar Sesión</span>
                </button>
                
                <div class="forgot-password">
                    <a href="#" id="modal-toggle-form">¿No tienes cuenta? Regístrate aquí</a>
                </div>
            </form>
            
            <div class="login-footer">
                <span>&copy; 2023 CFT Los Ríos. Todos los derechos reservados.</span>
            </div>
        </div>
    </div>
    
    <!-- Notificaciones, añadidas al body principal -->
    <div class="notification error" id="errorNotification">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorMessage"></span>
    </div>
    
    <div class="notification success" id="successNotification">
        <i class="fas fa-check-circle"></i>
        <span id="successMessage"></span>
    </div>

    <script>
        /*
           ====================================================================
           SECCIÓN: VARIABLES Y CONSTANTES GLOBALES
           Descripción: Declaración de todas las referencias a elementos del DOM
                        y valores constantes para fácil acceso y modificación.
           ====================================================================
        */
        // Users database (5 random users with @cftrl.cl emails and RUT passwords)
        // Estos son los datos de usuario "actualizados" que mencionaste.
        const users = [
            {
                name: "Henrry Alocilla",
                email: "henrryalocilla@cftlr.cl",
                password: "12345678-9"
            },
            {
                name: "Alex Reyes",
                email: "alexreyes@cftlr.cl",
                password: "16870931-5"
            },
            {
                name: "Renato Sandoval",
                email: "renatosandoval@cftlr.cl",
                password: "21638623-k" 
            },
            {
                name: "Diego Vergara",
                email: "diegovergara@cftlr.cl",
                password: "19764816-3"
            },
            {
                name: "Fernando Millapan",
                email: "fernandomillapan@cftlr.cl",
                password: "21596595-3"
            }
        ];

        // Directorio de contactos (NUEVO: organizado por sede y con datos de Paillaco actualizados)
        const directoryDataBySede = {
            "Sede Valdivia": [
                {
                    name: "Dr. Ana Rojas",
                    position: "Directora Académica",
                    email: "arojas@cftrl.cl",
                    phone: "+56 9 1111 2222",
                    department: "Administración",
                    icon: "&#127891;" // Icono de birrete
                },
                {
                    name: "Prof. Ricardo Soto",
                    position: "Jefe de Carrera (Programación)",
                    email: "rsoto@cftrl.cl",
                    phone: "+56 9 3333 4444",
                    department: "Informática",
                    icon: "&#128187;" // Icono de laptop
                }
            ],
            "Sede La Unión": [
                {
                    name: "Ing. Carla Fuentes",
                    position: "Coordinadora de Prácticas",
                    email: "cfuentes@cftrl.cl",
                    phone: "+56 9 5555 6666",
                    department: "Vinculación con el Medio",
                    icon: "&#128188;" // Icono de maletín
                },
                {
                    name: "Sra. Elena Paredes",
                    position: "Secretaria Académica",
                    email: "eparedes@cftrl.cl",
                    phone: "+56 9 7777 8888",
                    department: "Secretaría General",
                    icon: "&#128100;" // Icono de busto/persona
                }
            ],
            "Sede Paillaco": [ // Datos actualizados
                {
                    name: "Mauricio Peters",
                    position: "Coordinador Sede",
                    email: "mpeters@cftdelosrios.cl",
                    phone: "+56 9 2100 0001", // Teléfono ficticio
                    department: "Coordinación",
                    icon: "&#128204;" // Icono de pin de mapa
                },
                {
                    name: "Abraham Acevedo",
                    position: "Registro Curricular",
                    email: "aacevedo@cftdelosrios.cl",
                    phone: "+56 9 2100 0002", // Teléfono ficticio
                    department: "Académico",
                    icon: "&#128220;" // Icono de notas
                },
                {
                    name: "Felipe Fierro",
                    position: "Experiencia Estudiantil",
                    email: "ffierro@cftdelosrios.cl",
                    phone: "+56 9 2100 0003", // Teléfono ficticio
                    department: "DAE",
                    icon: "&#128100;" // Icono de persona
                },
                {
                    name: "Scarlett Barra",
                    position: "Psicóloga",
                    email: "sbarra@cftdelosrios.cl",
                    phone: "+56 9 2100 0004", // Teléfono ficticio
                    department: "Equipo Psicosocial",
                    icon: "&#129504;" // Icono de cerebro
                },
                {
                    name: "María José Pardo",
                    position: "Psicopedagoga",
                    email: "mpardo@cftdelosrios.cl",
                    phone: "+56 9 2100 0005", // Teléfono ficticio
                    department: "Equipo Psicosocial",
                    icon: "&#128218;" // Icono de libro
                },
                {
                    name: "Camila Donoso",
                    position: "Admisión",
                    email: "cdonoso@cftdelosrios.cl",
                    phone: "+56 9 2100 0006", // Teléfono ficticio
                    department: "Admisión",
                    icon: "&#128273;" // Icono de llave
                }
            ]
        };


        // Elementos de navegación
        const menuToggle = document.querySelector('.menu-toggle');
        const navUl = document.querySelector('nav ul');
        const profileNavLink = document.getElementById('profile-nav-link');
        const navProfilePic = document.getElementById('nav-profile-pic');

        // Elementos de contenido y secciones
        const allContentSections = document.querySelectorAll('.content-section, .modules-grid');
        const homeSection = document.getElementById('home-section');
        const modulesSection = document.getElementById('modules-section');
        const userProfileDetailSection = document.getElementById('user-profile-detail-section');
        const directorySection = document.getElementById('directory-section'); // NUEVO
        const notesAttendanceSection = document.getElementById('notes-attendance-section'); // NUEVO
        const academicCalendarSection = document.getElementById('academic-calendar-section'); // Agregado para consistencia
        const notificationsSection = document.getElementById('notifications-section'); // Agregado para consistencia
        const scholarshipsSection = document.getElementById('scholarships-section'); // NUEVO
        const backButtons = document.querySelectorAll('.back-button');

        // Elementos del Modal de Autenticación (actualizados para el nuevo login)
        const loginModal = document.getElementById('login-modal');
        const closeModalButton = document.querySelector('.close-button');
        const modalTitle = document.getElementById('modal-title'); // Título dentro del login-header
        const authForm = document.getElementById('auth-form'); // El formulario principal del login
        const emailInput = document.getElementById('email'); // Campo de email del nuevo login
        const passwordInput = document.getElementById('password'); // Campo de contraseña del nuevo login
        const loginBtn = document.getElementById('loginBtn'); // Botón de login del nuevo login
        const modalToggleFormLink = document.getElementById('modal-toggle-form'); // Enlace para alternar entre login/registro
        const loginContainerMain = document.getElementById('loginContainerMain'); // El contenedor principal del formulario de login para animaciones
        
        // Elementos de Notificación (del nuevo login)
        const errorNotification = document.getElementById('errorNotification');
        const successNotification = document.getElementById('successNotification');
        const errorMessageSpan = document.getElementById('errorMessage');
        const successMessageSpan = document.getElementById('successMessage');

        // Elementos del Dropdown de Perfil (en Header)
        const profileDropdown = document.getElementById('profile-dropdown');
        const dropdownProfilePic = document.getElementById('dropdown-profile-pic');
        const dropdownUsername = document.getElementById('dropdown-username');

        // Elementos de la sección de Perfil Detallado
        const profileForm = document.getElementById('profile-form');
        const profilePic = document.getElementById('profile-pic');
        const profileImageUpload = document.getElementById('profile-image-upload');
        const deleteProfilePicBtn = document.getElementById('delete-profile-pic-btn');
        const profileNameInput = document.getElementById('profile-name');
        const profileEmailInput = document.getElementById('profile-email');
        const profilePhoneInput = document.getElementById('profile-phone');
        const profileRutInput = document.getElementById('profile-rut');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const saveProfileBtn = document.getElementById('save-profile-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const profileMessage = document.getElementById('profile-message');

        // Elementos del Formulario de Notificaciones
        const notificationForm = document.getElementById('notificationForm');
        const emailNotificationInput = document.getElementById('email_notification');
        const phoneNotificationInput = document.getElementById('phone_notification');
        const messageNotificationInput = document.getElementById('message_notification');
        const responseMessageNotificationDiv = document.getElementById('responseMessageNotification');

        // Elementos del Directorio (NUEVOS)
        const directoryList = document.getElementById('directory-list');
        const contactDetailsModal = document.getElementById('contact-details-modal');
        const closeContactDetailsModalBtn = document.getElementById('close-contact-details-modal');
        const contactDetailsTitle = document.getElementById('contact-details-title');
        const contactDetailsOutput = document.getElementById('contact-details-output');


        // Constantes
        const DEFAULT_AVATAR_PATH = 'https://placehold.co/120x120/D3D3D3/000?text=Avatar'; // Ruta a una imagen de avatar por defecto
        let isRegistering = false; // Estado para el formulario de autenticación (registro vs. login)


        /*
           ====================================================================
           SECCIÓN: FUNCIONES DE UTILIDAD (HELPERS)
           Descripción: Funciones genéricas y reutilizables para tareas comunes.
           ====================================================================
        */

        /**
         * Obtiene el valor de una variable CSS definida en :root.
         * @param {string} variableName - El nombre de la variable CSS (ej. '--color-primario').
         * @returns {string} El valor de la variable CSS.
         */
        function getCssVariable(variableName) {
            return getComputedStyle(document.documentElement).getPropertyValue(variableName).trim();
        }

        /**
         * Oculta todas las secciones de contenido activas.
         */
        function hideAllSections() {
            allContentSections.forEach(section => {
                section.classList.remove('active-section');
            });
        }

        /**
         * Muestra una sección específica y oculta las demás.
         * Realiza comprobaciones de autenticación para secciones protegidas.
         * @param {string} sectionId - El ID de la sección a mostrar (sin '-section', ej. 'home', 'modules').
         */
        function showSection(sectionId) {
            const loggedInUser = localStorage.getItem('currentUserEmail');
            const protectedSections = ['user-profile-detail', 'notes-attendance', 'academic-calendar', 'notifications', 'directory', 'scholarships', 'report-issue'];

            // Lógica para el logo (si se hace clic en él)
            if (sectionId === 'main-menu') {
                sectionId = loggedInUser ? 'modules' : 'home';
            }

            // Redirige a login si intenta acceder a una sección protegida sin autenticación
            if (protectedSections.includes(sectionId) && !loggedInUser) {
                hideAllSections();
                homeSection.classList.add('active-section');
                openLoginModal();
                showNotification('error', 'Debes iniciar sesión para acceder a esta función.');
                return;
            }

            hideAllSections(); // Oculta todas antes de mostrar la deseada

            const targetSectionElement = document.getElementById(`${sectionId}-section`);
            if (targetSectionElement) {
                targetSectionElement.classList.add('active-section');
                // Si la sección es el directorio, renderiza la lista
                if (sectionId === 'directory') {
                    renderDirectory();
                } else if (sectionId === 'notes-attendance') { // NUEVO: Inicializa la sección de notas
                    initializeNotesSection();
                } else if (sectionId === 'scholarships') { // NUEVO: Inicializa la sección de becas
                    // No hay lógica JS compleja para la sección de becas, solo asegura que los enlaces toggleBeca funcionen.
                    // La función toggleBeca ya está globalmente disponible, por lo que no se necesita una llamada de inicialización específica aquí.
                }
            }

            // Asegura que la sección de módulos se active solo cuando corresponde
            if (loggedInUser && sectionId === 'modules') {
                modulesSection.classList.add('active-section');
            } else {
                modulesSection.classList.remove('active-section');
            }

            // Carga datos del perfil si se va a la sección de detalles del perfil
            if (sectionId === 'user-profile-detail' && loggedInUser) {
                loadProfileData(loggedInUser);
                setProfileFormState(false); // Por defecto, el formulario de perfil está en modo de visualización
            }

            // Manejo de la visibilidad de los botones de retroceso
            backButtons.forEach(button => {
                const parentSection = button.closest('.content-section');
                if (parentSection) {
                    const parentSectionId = parentSection.id.replace('-section', '');
                    if (sectionId === parentSectionId && sectionId !== 'home' && sectionId !== 'modules') {
                        button.style.display = 'flex';
                    } else {
                        button.style.display = 'none';
                    }
                }
            });
        }

        /**
         * Muestra una notificación temporal en la esquina superior derecha.
         * @param {string} type - 'success' o 'error'.
         * @param {string} message - El mensaje a mostrar.
         */
        function showNotification(type, message) {
            const notificationElement = type === 'success' ? successNotification : errorNotification;
            const messageSpan = type === 'success' ? successMessageSpan : errorMessageSpan;

            // Hide the other notification if it's currently showing
            const otherNotification = type === 'success' ? errorNotification : successNotification;
            otherNotification.classList.remove('show');
            otherNotification.classList.remove(type === 'success' ? 'error' : 'success'); // Remove class to prevent conflicts

            messageSpan.textContent = message;
            notificationElement.classList.add('show');
            notificationElement.classList.add(type); // Add the specific type class

            setTimeout(() => {
                notificationElement.classList.remove('show');
                notificationElement.classList.remove(type); // Remove type class after hiding
            }, 3000); // Notification visible for 3 seconds
        }


        /**
         * Función para mostrar mensajes al usuario dentro del formulario de notificaciones.
         * @param {string} message - El mensaje a mostrar.
         * @param {string} type - 'success', 'error' o 'info'.
         */
        function showFormMessage(message, type) {
            responseMessageNotificationDiv.textContent = message;
            responseMessageNotificationDiv.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800', 'bg-blue-100', 'text-blue-800');
            if (type === 'success') {
                responseMessageNotificationDiv.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                responseMessageNotificationDiv.classList.add('bg-red-100', 'text-red-800');
            } else {
                responseMessageNotificationDiv.classList.add('bg-blue-100', 'text-blue-800');
            }
        }


        /*
           ====================================================================
           SECCIÓN: LÓGICA DE AUTENTICACIÓN Y MODAL
           Descripción: Funciones para abrir/cerrar el modal de login/registro,
                        gestionar el estado del formulario y manejar la autenticación.
           ====================================================================
        */

        /**
         * Abre el modal de inicio de sesión/registro.
         */
        function openLoginModal() {
            loginModal.classList.add('show');
            emailInput.value = '';
            passwordInput.value = '';
            setFormToLoginMode(); // Asegurarse de que el formulario empiece en modo login
        }

        /**
         * Cierra el modal de inicio de sesión/registro.
         */
        function closeLoginModal() {
            loginModal.classList.remove('show');
            // Ensure no lingering shake effect
            if (loginContainerMain.classList.contains('shake')) {
                loginContainerMain.classList.remove('shake');
            }
        }

        /**
         * Configura el formulario del modal en modo "Iniciar Sesión".
         */
        function setFormToLoginMode() {
            isRegistering = false;
            modalTitle.textContent = 'Intranet CFT Los Ríos'; // Título del nuevo login
            document.querySelector('.login-subtitle').textContent = 'Ingresa tus credenciales para acceder';
            loginBtn.querySelector('.btn-text').textContent = 'Iniciar Sesión';
            modalToggleFormLink.textContent = '¿No tienes cuenta? Regístrate aquí';
            // Clear any previous error messages
            errorMessageSpan.textContent = '';
            successMessageSpan.textContent = '';
            errorNotification.classList.remove('show');
            successNotification.classList.remove('show');
        }

        /**
         * Configura el formulario del modal en modo "Registrarse".
         */
        function setFormToRegisterMode() {
            isRegistering = true;
            modalTitle.textContent = 'Registrarse en CFT Los Ríos';
            document.querySelector('.login-subtitle').textContent = 'Crea tu cuenta para acceder';
            loginBtn.querySelector('.btn-text').textContent = 'Registrarse';
            modalToggleFormLink.textContent = 'Ya tengo cuenta, Iniciar Sesión';
            // Clear any previous error messages
            errorMessageSpan.textContent = '';
            successMessageSpan.textContent = '';
            errorNotification.classList.remove('show');
            successNotification.classList.remove('show');
        }

        /**
         * Muestra/oculta el spinner de carga en el botón de login.
         * @param {boolean} isLoading - True para mostrar, false para ocultar.
         */
        function setLoading(isLoading) {
            if (isLoading) {
                loginBtn.classList.add('loading');
                loginBtn.disabled = true;
            } else {
                loginBtn.classList.remove('loading');
                loginBtn.disabled = false;
            }
        }

        /**
         * Actualiza la interfaz de usuario de la barra de navegación en función del estado de autenticación.
         * Muestra/oculta el enlace de perfil y actualiza la foto/nombre.
         * También gestiona la visibilidad del botón de menú móvil.
         */
        function updateAuthUI() {
            const loggedInUser = localStorage.getItem('currentUserEmail');
            if (loggedInUser) {
                document.body.classList.add('logged-in'); // Añade la clase al body
                profileNavLink.style.display = 'list-item'; // Muestra el li del perfil

                const profile = getProfileData(loggedInUser); // Obtiene los datos del perfil
                navProfilePic.src = profile.profilePic || DEFAULT_AVATAR_PATH;
                dropdownProfilePic.src = profile.profilePic || DEFAULT_AVATAR_PATH;
                dropdownUsername.textContent = profile.name || loggedInUser;
                showSection('modules'); // Redirige a la sección de módulos al iniciar sesión
            } else {
                document.body.classList.remove('logged-in'); // Elimina la clase del body
                profileNavLink.style.display = 'none'; // Oculta el li del perfil
                profileDropdown.classList.remove('show'); // Asegura que el dropdown esté oculto
                showSection('home'); // Redirige a la sección de inicio si no está logueado
            }
        }


        /*
           ====================================================================
           SECCIÓN: LÓGICA DE GESTIÓN DE PERFIL
           Descripción: Funciones para cargar, guardar y editar los datos del perfil,
                        incluyendo la foto de perfil.
           ====================================================================
        */

        /**
         * Obtiene los datos del perfil de un usuario del localStorage.
         * Si no existe, devuelve un perfil por defecto.
         * @param {string} email - El email del usuario.
         * @returns {object} Un objeto con los datos del perfil.
         */
        function getProfileData(email) {
            const profileKey = `profile_${email}`;
            const storedProfile = localStorage.getItem(profileKey);
            if (storedProfile) {
                return JSON.parse(storedProfile);
            } else {
                // Si el usuario existe en 'users' pero no tiene perfil en localStorage, creamos uno básico
                const userInDb = users.find(user => user.email === email);
                return {
                    name: userInDb ? userInDb.name : 'Estudiante CFT',
                    email: email,
                    phone: '+56 9 1234 5678', // Default phone
                    rut: userInDb ? userInDb.password : '12.345.678-K', // Use password as RUT for default
                    profilePic: DEFAULT_AVATAR_PATH
                };
            }
        }

        /**
         * Guarda los datos de un perfil en el localStorage y actualiza la UI si es el usuario actual.
         * @param {string} email - El email del usuario.
         * @param {object} profile - El objeto con los datos del perfil a guardar.
         */
        function saveProfileData(email, profile) {
            const profileKey = `profile_${email}`;
            localStorage.setItem(profileKey, JSON.stringify(profile));
            const loggedInUser = localStorage.getItem('currentUserEmail');
            if (loggedInUser === email) {
                navProfilePic.src = profile.profilePic || DEFAULT_AVATAR_PATH;
                dropdownProfilePic.src = profile.profilePic || DEFAULT_AVATAR_PATH;
                dropdownUsername.textContent = profile.name || loggedInUser;
            }
        }

        /**
         * Carga los datos del perfil del usuario actual en el formulario de detalles de perfil.
         * @param {string} email - El email del usuario actual.
         */
        function loadProfileData(email) {
            const profile = getProfileData(email);
            profileNameInput.value = profile.name;
            profileEmailInput.value = profile.email;
            profilePhoneInput.value = profile.phone;
            profileRutInput.value = profile.rut;
            profilePic.src = profile.profilePic || DEFAULT_AVATAR_PATH;
            
            // Determina si se muestra el botón de eliminar foto
            const isDefaultPic = profile.profilePic === DEFAULT_AVATAR_PATH || (window.location.origin + '/' + DEFAULT_AVATAR_PATH) === profile.profilePic;
            deleteProfilePicBtn.style.display = isDefaultPic ? 'none' : 'inline-block';
            profileMessage.textContent = '';
        }

        /**
         * Establece el estado del formulario de perfil (edición o visualización).
         * Habilita/deshabilita campos y muestra/oculta botones.
         * @param {boolean} isEditing - `true` para modo edición, `false` para modo visualización.
         */
        function setProfileFormState(isEditing) {
            profileNameInput.disabled = !isEditing;
            profilePhoneInput.disabled = !isEditing;
            profileRutInput.disabled = !isEditing;

            profilePic.style.cursor = isEditing ? 'pointer' : 'default';

            editProfileBtn.style.display = isEditing ? 'none' : 'inline-block';
            saveProfileBtn.style.display = isEditing ? 'inline-block' : 'none';
            cancelEditBtn.style.display = isEditing ? 'inline-block' : 'none';
            
            // El botón de eliminar foto solo se muestra si está editando Y no es la foto por defecto
            const isDefaultPic = profilePic.src.includes(DEFAULT_AVATAR_PATH);
            deleteProfilePicBtn.style.display = (isEditing && !isDefaultPic) ? 'inline-block' : 'none';
        }

        /**
         * Maneja la subida de una nueva foto de perfil.
         * Convierte la imagen a Data URL y la guarda en localStorage.
         * @param {Event} e - El evento de cambio del input file.
         */
        function handleProfileImageUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    profilePic.src = event.target.result;
                    const loggedInUser = localStorage.getItem('currentUserEmail');
                    if (loggedInUser) {
                        const currentProfile = getProfileData(loggedInUser);
                        currentProfile.profilePic = event.target.result;
                        saveProfileData(loggedInUser, currentProfile);
                        profileMessage.textContent = 'Foto de perfil cargada. Haz clic en "Guardar Cambios".';
                        profileMessage.style.color = getCssVariable('--color-advertencia');
                        deleteProfilePicBtn.style.display = 'inline-block';
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        /**
         * Elimina la foto de perfil del usuario, volviendo al avatar por defecto.
         */
        function handleDeleteProfilePic() {
            const loggedInUser = localStorage.getItem('currentUserEmail');
            if (loggedInUser) {
                const currentProfile = getProfileData(loggedInUser);
                currentProfile.profilePic = DEFAULT_AVATAR_PATH;
                profilePic.src = DEFAULT_AVATAR_PATH;
                saveProfileData(loggedInUser, currentProfile);
                profileMessage.textContent = 'Foto de perfil eliminada. Haz clic en "Guardar Cambios".';
                profileMessage.style.color = getCssVariable('--color-advertencia');
                deleteProfilePicBtn.style.display = 'none';
            }
        }

        /*
           ====================================================================
           SECCIÓN: LÓGICA DEL DIRECTORIO (ACTUALIZADA para mostrar por sede)
           ====================================================================
        */

        /**
         * Renderiza la lista de contactos del directorio, agrupados por sede.
         */
        function renderDirectory() {
            directoryList.innerHTML = ''; // Limpia la lista existente
            
            for (const sede in directoryDataBySede) {
                if (directoryDataBySede.hasOwnProperty(sede)) {
                    // Crea un encabezado para la sede
                    const sedeHeading = document.createElement('h2');
                    sedeHeading.classList.add('sede-title'); // Clase para el estilo del título de sede
                    sedeHeading.textContent = sede;
                    directoryList.appendChild(sedeHeading);

                    // Crea un contenedor para los contactos de esta sede (que será un grid)
                    const sedeContactsGrid = document.createElement('div');
                    sedeContactsGrid.classList.add('directory-grid'); // Aplica las clases de grid aquí

                    directoryDataBySede[sede].forEach((contact, index) => {
                        const card = document.createElement('div');
                        card.classList.add('directory-card');
                        // Usamos un identificador único para el contacto que incluya la sede y el índice
                        card.dataset.contactId = `${sede.replace(/\s/g, '')}-${index}`; 
                        card.innerHTML = `
                            <span class="icon">${contact.icon}</span>
                            <div>
                                <h3>${contact.name}</h3>
                                <p>${contact.position}</p>
                            </div>
                        `;
                        sedeContactsGrid.appendChild(card);
                    });
                    directoryList.appendChild(sedeContactsGrid);
                }
            }

            // Añadir event listeners a las nuevas tarjetas del directorio
            // Delegamos el evento al contenedor principal para evitar añadir muchos listeners
            directoryList.addEventListener('click', (e) => {
                const card = e.target.closest('.directory-card');
                if (card) {
                    const contactId = card.dataset.contactId;
                    // Encontrar el contacto usando el contactId
                    let foundContact = null;
                    for (const sede in directoryDataBySede) {
                        const contactIndex = parseInt(contactId.split('-').pop());
                        // La parte del contactId antes del último '-' debe coincidir con la sede normalizada
                        if (contactId.startsWith(sede.replace(/\s/g, '')) && directoryDataBySede[sede][contactIndex]) {
                             foundContact = directoryDataBySede[sede][contactIndex];
                             break;
                        }
                    }

                    if (foundContact) {
                        showContactDetailsModal(foundContact);
                    }
                }
            });
        }

        /**
         * Muestra un modal con los detalles del contacto en formato normal (no C++-like).
         * @param {object} contact - El objeto de contacto a mostrar.
         */
        function showContactDetailsModal(contact) {
            contactDetailsTitle.textContent = `Detalles de ${contact.name}`;
            contactDetailsOutput.innerHTML = `
                <p><strong>Cargo:</strong> ${contact.position}</p>
                <p><strong>Departamento:</strong> ${contact.department}</p>
                <p><strong>Email:</strong> <a href="mailto:${contact.email}">${contact.email}</a></p>
                <p><strong>Teléfono:</strong> <a href="tel:${contact.phone}">${contact.phone}</a></p>
            `;
            contactDetailsModal.classList.add('show');
        }

        /**
         * Cierra el modal de detalles del contacto.
         */
        function closeContactDetailsModal() {
            contactDetailsModal.classList.remove('show');
        }

        /**
         * Inicializa la sección de Notas y Asistencia:
         * - Cambia el color de las notas según su valor.
         * - Anima las tarjetas de las materias.
         */
        function initializeNotesSection() {
            // Cambiar el color de las notas según su valor
            document.querySelectorAll('#notes-attendance-section .nota-value').forEach(nota => {
                const value = parseFloat(nota.textContent);
                if (value < 4.0) {
                    nota.style.backgroundColor = getCssVariable('--color-error'); // Rojo para notas bajas
                } else if (value < 5.0) {
                    nota.style.backgroundColor = getCssVariable('--accent-login-color'); // Naranjo para notas regulares
                } else {
                    nota.style.backgroundColor = getCssVariable('--color-exito'); // Verde para notas buenas
                }
            });
            
            // Animación al cargar las tarjetas
            const cards = document.querySelectorAll('#notes-attendance-section .materia-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0'; // Reset opacity for re-animation
                card.style.transform = 'translateY(20px)'; // Reset transform for re-animation
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 100 * index); // Staggered animation
            });
        }

        /**
         * Toggles the visibility of a scholarship item's content.
         * This function is called directly from inline onclick attributes in the HTML.
         * @param {HTMLElement} element - The header element of the scholarship item.
         */
        function toggleBeca(element) {
            const content = element.nextElementSibling;
            const icon = element.querySelector('.toggle-icon');
            if (content.style.display === "block") {
                content.style.display = "none";
                icon.textContent = "+";
            } else {
                content.style.display = "block";
                icon.textContent = "-";
            }
        }


        /*
           ====================================================================
           SECCIÓN: CONFIGURACIÓN DE EVENT LISTENERS
           Descripción: Agrupa todos los escuchadores de eventos para mejorar
                        la organización y la legibilidad.
           ====================================================================
        */

        /**
         * Configura todos los escuchadores de eventos de la aplicación.
         */
        function setupEventListeners() {
            // Navegación y menú móvil
            menuToggle.addEventListener('click', () => {
                navUl.classList.toggle('active');
                profileDropdown.classList.remove('show'); // Asegura que el dropdown de perfil se cierre al abrir/cerrar el menú móvil
            });

            // Clic en el enlace del perfil en la navegación (para mostrar/ocultar dropdown en desktop)
            profileNavLink.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                if (navUl.classList.contains('active')) {
                    // Si el menú móvil está activo, navega a la sección de perfil
                    navUl.classList.remove('active');
                    showSection('user-profile-detail');
                } else {
                    // Si no, alterna el dropdown de perfil (en desktop)
                    profileDropdown.classList.toggle('show');
                }
            });

            // Delegación de eventos para la barra de navegación (logo y enlaces generales)
            document.querySelector('header .container').addEventListener('click', (e) => {
                let target = e.target;
                if ((target.tagName === 'IMG' && target.closest('.logo')) || target.classList.contains('logo')) {
                    target = target.closest('.logo');
                }
                if (target.tagName === 'A' && target.dataset.section) {
                    e.preventDefault();
                    navUl.classList.remove('active');
                    showSection(target.dataset.section);
                }
            });

            // Clics dentro del dropdown de perfil (Ver Perfil, Cerrar Sesión)
            profileDropdown.addEventListener('click', (e) => {
                e.stopPropagation(); // Evita que el clic se propague al documento
                const target = e.target;
                if (target.tagName === 'A') {
                    e.preventDefault();
                    profileDropdown.classList.remove('show'); // Cierra el dropdown
                    navUl.classList.remove('active'); // Asegura que el menú móvil también se cierre
                    if (target.dataset.section === 'user-profile-detail') {
                        showSection('user-profile-detail');
                    } else if (target.dataset.action === 'logout') {
                        localStorage.removeItem('currentUserEmail');
                        updateAuthUI(); // Actualiza la UI después del logout
                    }
                }
            });

            // Clics en las tarjetas de módulo
            document.querySelectorAll('.module-card').forEach(card => {
                card.addEventListener('click', () => {
                    const targetSection = card.dataset.section;
                    if (targetSection) {
                        showSection(targetSection);
                    }
                });
            });

            // Botón "Iniciar Sesión" en la sección de bienvenida
            document.querySelector('#home-section .btn-primario').addEventListener('click', openLoginModal);
            
            // Cerrar modal
            closeModalButton.addEventListener('click', closeLoginModal);
            window.addEventListener('click', (e) => {
                if (e.target === loginModal) {
                    closeLoginModal();
                }
            });

            // Toggle entre registro y login dentro del modal
            modalToggleFormLink.addEventListener('click', (e) => {
                e.preventDefault();
                // Remove shake class before changing mode
                loginContainerMain.classList.remove('shake');
                isRegistering ? setFormToLoginMode() : setFormToRegisterMode();
            });

            // Envío del formulario de autenticación (loginBtn submit)
            authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                setLoading(true); // Show loading spinner
                loginContainerMain.classList.remove('shake'); // Remove shake animation if present

                const email = emailInput.value.trim();
                const password = passwordInput.value.trim();

                if (email.length < 5 || password.length < 4) {
                    showNotification('error', 'El email debe tener al menos 5 caracteres y la contraseña al menos 4.');
                    loginContainerMain.classList.add('shake'); // Add shake animation
                    setLoading(false);
                    return;
                }

                if (isRegistering) {
                    // Check if email exists in the hardcoded 'users' array
                    const userExists = users.some(user => user.email === email);
                    if (userExists || localStorage.getItem(email)) { // Also check local storage for consistency
                        showNotification('error', 'Este email ya está registrado o en uso.');
                        loginContainerMain.classList.add('shake');
                        setLoading(false);
                    } else {
                        // For demonstration, register directly to localStorage and add to our 'users' array
                        localStorage.setItem(email, password);
                        // Add to in-memory 'users' array for immediate use
                        users.push({ name: 'Nuevo Estudiante', email: email, password: email }); // Use email as password for new user
                        
                        // Initialize basic profile data for new user in localStorage
                        saveProfileData(email, { name: 'Nuevo Estudiante', email: email, phone: '', rut: '', profilePic: DEFAULT_AVATAR_PATH });
                        
                        localStorage.setItem('currentUserEmail', email);
                        showNotification('success', '¡Registro exitoso! Has iniciado sesión.');
                        loginContainerMain.classList.add('success-pulse'); // Add success animation
                        setTimeout(() => { 
                            closeLoginModal(); 
                            updateAuthUI(); 
                            loginContainerMain.classList.remove('success-pulse'); // Remove pulse after transition
                            setLoading(false);
                        }, 1000); // Allow time for success message and animation
                    }
                } else { // Login
                    const foundUser = users.find(user => user.email === email && user.password === password);
                    const storedPassword = localStorage.getItem(email); // Also check localStorage for dynamically registered users

                    if (foundUser || (storedPassword && storedPassword === password)) {
                        localStorage.setItem('currentUserEmail', email);
                        showNotification('success', '¡Inicio de sesión exitoso! Entrando a la Intranet de CFT Los Ríos.');
                        loginContainerMain.classList.add('success-pulse'); // Add success animation
                        setTimeout(() => { 
                            closeLoginModal(); 
                            updateAuthUI(); 
                            loginContainerMain.classList.remove('success-pulse'); // Remove pulse after transition
                            setLoading(false);
                        }, 1000); // Allow time for success message and animation
                    } else {
                        showNotification('error', 'Credenciales no válidas, Intente nuevamente.');
                        loginContainerMain.classList.add('shake'); // Add shake animation
                        setLoading(false);
                    }
                }
            });

            // Perfil detallado - Edición, Guardar, Cancelar
            editProfileBtn.addEventListener('click', () => {
                setProfileFormState(true);
                profileMessage.textContent = '';
            });

            cancelEditBtn.addEventListener('click', () => {
                const loggedInUser = localStorage.getItem('currentUserEmail');
                if (loggedInUser) loadProfileData(loggedInUser);
                setProfileFormState(false);
                profileMessage.textContent = 'Edición cancelada.';
                profileMessage.style.color = getCssVariable('--color-advertencia');
            });

            profileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const loggedInUser = localStorage.getItem('currentUserEmail');
                if (!loggedInUser) {
                    profileMessage.textContent = 'Error: Debes iniciar sesión para guardar tu perfil.';
                    profileMessage.style.color = getCssVariable('--color-error');
                    return;
                }

                if (!profileNameInput.value.trim() || !profileEmailInput.value.trim() || !profileEmailInput.value.includes('@')) {
                    profileMessage.textContent = 'Por favor, completa los campos requeridos con datos válidos.';
                    profileMessage.style.color = getCssVariable('--color-error');
                    return;
                }

                const currentProfile = getProfileData(loggedInUser);
                const updatedProfile = {
                    name: profileNameInput.value.trim(),
                    email: profileEmailInput.value.trim(), // Email no se puede editar, pero se mantiene en el objeto
                    phone: profilePhoneInput.value.trim(),
                    rut: profileRutInput.value.trim(),
                    profilePic: currentProfile.profilePic
                };
                saveProfileData(loggedInUser, updatedProfile);
                profileMessage.textContent = '¡Perfil actualizado exitosamente!';
                profileMessage.style.color = getCssVariable('--color-exito');
                setProfileFormState(false);
            });

            // Gestión de foto de perfil
            profilePic.addEventListener('click', () => {
                if (!profileNameInput.disabled) profileImageUpload.click(); // Permite clickear solo en modo edición
            });
            profileImageUpload.addEventListener('change', handleProfileImageUpload);
            deleteProfilePicBtn.addEventListener('click', handleDeleteProfilePic);

            // Botones de retroceso
            backButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const loggedInUser = localStorage.getItem('currentUserEmail');
                    showSection(loggedInUser ? 'modules' : 'home');
                });
            });

            // Cierra el dropdown de perfil si se hace clic fuera de él (en desktop)
            document.addEventListener('click', (e) => {
                if (!profileNavLink.contains(e.target) && profileDropdown.classList.contains('show') && !navUl.classList.contains('active')) {
                    profileDropdown.classList.remove('show');
                }
            });

            // Lógica del Formulario de Notificaciones
            notificationForm.addEventListener('submit', async (event) => {
                event.preventDefault(); // Evita el envío del formulario por defecto (recarga de página)

                const email = emailNotificationInput.value;
                const phone = phoneNotificationInput.value;
                const message = messageNotificationInput.value;

                // Validación básica de campos
                if (!email || !phone || !message) {
                    showFormMessage('Por favor, completa todos los campos.', 'error');
                    return;
                }

                // Validación simple de formato de correo electrónico
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showFormMessage('Por favor, introduce un correo electrónico válido.', 'error');
                    return;
                }

                // Simulación de envío (esta parte no es real)
                showFormMessage('Enviando notificación...', 'info');

                // En un entorno real, aquí harías una petición a tu servidor backend:
                /*
                try {
                    const response = await fetch('/api/send-notification', { // Esta URL sería la de tu backend
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email, phone, message })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        showFormMessage(`Notificación enviada con éxito a ${email} y ${phone}.`, 'success');
                        notificationForm.reset(); // Limpia el formulario
                    } else {
                        const errorData = await response.json();
                        showFormMessage(`Error al enviar la notificación: ${errorData.message || 'Error desconocido'}`, 'error');
                    }
                } catch (error) {
                    console.error('Error de red o del servidor:', error);
                    showFormMessage('Hubo un problema de conexión. Inténtalo de nuevo.', 'error');
                }
                */

                // Para esta simulación, simplemente esperamos un poco y mostramos éxito
                await new Promise(resolve => setTimeout(resolve, 2000)); // Simula un retraso de 2 segundos

                showFormMessage(`Notificación ficticia enviada a: Correo (${email}), Teléfono (${phone}). Mensaje: "${message}"`, 'success');
                notificationForm.reset(); // Limpia el formulario después de la simulación
            });

            // Lógica del Modal de Detalles del Contacto (NUEVO)
            closeContactDetailsModalBtn.addEventListener('click', closeContactDetailsModal);
            window.addEventListener('click', (e) => {
                if (e.target === contactDetailsModal) {
                    closeContactDetailsModal();
                }
            });

        }

        /*
           ====================================================================
           SECCIÓN: INICIALIZACIÓN
           Descripción: Función que se ejecuta cuando el DOM está completamente
                        cargado para configurar la aplicación.
           ====================================================================
        */
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners(); // Configura todos los eventos
            updateAuthUI(); // Actualiza la interfaz de usuario según el estado de autenticación inicial
        });
    </script>
</body>
</html>
